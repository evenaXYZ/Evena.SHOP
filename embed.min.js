const version = '2.5.0';
let handledElements = [];
function setHandlers() {
	0 !== handledElements.length &&
		(console.info('Clearing old element handlers'),
		handledElements.forEach(function (e) {
			console.info('Removed handler for ' + e), e.removeEventListener('click', openSellSnModal);
		}),
		(handledElements = []));
	var e = document.querySelectorAll(
		'[data-sellsn-sid][data-sellsn-pid], [data-sellsn-sid][data-sellsn-gid]'
	);
	console.info(`Found ${e.length} elligible elements for handlers`),
		e.forEach(function (e) {
			(handledElements = [...handledElements, e]),
				e.addEventListener('click', openSellSnModal),
				console.info('Set handler for ' + e);
		});
}
function init() {
	if (document.getElementById('sellSnModalStyles')) console.info('Not reinjecting stylesheets');
	else {
		var l = document.createElement('link');
		(l.id = 'sellSnModalStyles'),
			(l.rel = 'stylesheet'),
			(l.href = 'https://pay.sellsn.io/embed/embed.css');
		let e = document.head;
		(e = e || document.body).appendChild(l), console.info('Injected stylesheets');
	}
}
function openSellSnModal(e, l, n, o, t = 1) {
	window.scrollTo({ top: 0, behavior: 'smooth' });
	var d = this;
	d !== window &&
		d.getAttribute('data-sellsn-sid') &&
		((e = d.getAttribute('data-sellsn-sid')),
		(l = d.getAttribute('data-sellsn-pid')),
		(n = d.getAttribute('data-sellsn-gid')),
		(o = d.getAttribute('data-sellsn-email')),
		(t = d.getAttribute('data-sellsn-quantity') ?? 1)),
		e && (l || n)
			? (injectModal(e, l, n, o, t),
			  document.getElementById('paySellSnModal').showModal(),
			  (document.body.style.overflow = 'hidden'))
			: console.error(
					'If you are calling openSellSnModal() directly, you need to give a store ID and product ID in the function arguments'
			  );
}
function injectModal(e, l, n, o, t) {
	(e = `
	<dialog id="paySellSnModal" class="dialog-style-xyz">
	<button onclick="closeSellSnModal()" class="dialog-button">
	<svg
		width="14"
		height="14"
		viewBox="0 0 12 12"
		fill="none"
		style="color: white;"
		xmlns="http://www.w3.org/2000/svg"
	>
		<path
		d="M1.13875 2.29016L1.2084 2.2205L1.13875 2.29016L4.84861 6.00007L1.13875 9.71008C1.13875 9.71009 1.13875 9.71009 1.13874 9.71009C0.82041 10.0284 0.820426 10.5431 1.13875 10.8614C1.29749 11.0202 1.50609 11.1 1.71444 11.1C1.92279 11.1 2.13139 11.0202 2.29013 10.8614L6 7.15155L9.70987 10.8614C9.86861 11.0202 10.0772 11.1 10.2856 11.1C10.4939 11.1 10.7025 11.0202 10.8613 10.8614C11.1796 10.5431 11.1796 10.0284 10.8613 9.71009C10.8613 9.71009 10.8612 9.71009 10.8612 9.71008L7.15138 6.00007L10.8613 2.29016C11.1796 1.97182 11.1796 1.45709 10.8613 1.13875C10.5429 0.820416 10.0282 0.820416 9.70987 1.13875L6 4.84866L2.29013 1.13875C1.9718 0.820416 1.45707 0.820416 1.13875 1.13875C0.820418 1.45709 0.820418 1.97182 1.13875 2.29016Z"
		fill="currentColor"
		stroke="currentColor"
		stroke-width="0.2"
		/>
	</svg>
	</button>
	<div role="alertdialog" class="dialog-inner">
	  <iframe
		referrerpolicy="no-referrer"
		title="SellSN Pay"
		src="${getFrameSrc(e, l, n, o, t)}"
		class="iframe-responsive"
	  ></iframe>
	</div>
  </dialog>  
    `),
		(l = document.createElement('div'));
	(l.innerHTML = e), document.body.appendChild(l), console.info('Injected modal');
}
function closeSellSnModal() {
	var e = document.getElementById('paySellSnModal');
	e && (e.remove(), (document.body.style.overflow = ''), console.info('Removed modal'));
}
function getFrameSrc(e, l, n, o, t) {
	let d = `https://pay.sellsn.io/embed/${e}/`;
	if (!l || !n)
		return (
			l && (d = d + '' + l),
			n && (d = d + 'group/' + n),
			(d = o ? (d = d + '?e=' + o) + '&q=' + (t ?? 1) : d + '?q=' + (t ?? 1))
		);
	console.error('Product ID and group ID cannot both be set, please set one or the other');
}
function initializeSellSnEmbed() {
	console.info('SellSN embeds v' + version), init(), setHandlers();
}
window.addEventListener('load', initializeSellSnEmbed),
	(window.initializeSellSnEmbed = initializeSellSnEmbed),
	(window.openSellSnModal = openSellSnModal),
	(window.closeSellSnModal = closeSellSnModal);
